<?xml version="1.0" encoding="UTF-8"?>
<api xmlns="http://ws.apache.org/ns/synapse"
    name="Health"
    context="/health"
    statistics="enable"
    trace="enable">
    <resource methods="GET"
        uri-template="/hospital/{hospitalId}">
        <inSequence>
            <log>
                <property name="**** [API]" value="IN - /hospital/{hospitalId}" />
            </log>
            <log category="DEBUG">
                <property name="hospitalId" expression="get-property('uri.var.hospitalId')" />
            </log>
            <send>
                <endpoint name="Blue">
                    <http method="GET"
                        uri-template="http://hospital-blue:8080/hospital/{uri.var.hospitalId}">
                        <timeout>
                            <duration>5000</duration>
                            <responseAction>fault</responseAction>
                        </timeout>
                        <suspendOnFailure>
                            <errorCodes>
                                101000,101001,101500,101501,101503,101504,101505,101506,101507,101508,101509,101510
                            </errorCodes>
                            <initialDuration>10000</initialDuration>
                            <progressionFactor>2</progressionFactor>
                            <maximumDuration>60000</maximumDuration>
                        </suspendOnFailure>
                    </http>
                </endpoint>
            </send>
        </inSequence>
        <outSequence>
            <log category="DEBUG">
                <property name="hospital_response" expression="json-eval($.)" />
            </log>
            <log>
                <property name="**** [API]" value="OUT - /hospital/{hospitalId}" />
            </log>
            <send />
        </outSequence>
        <!-- <faultSequence>
            <send />
        </faultSequence> -->
    </resource>
</api>